---
title: 本地存储
order: 5
---

## 本地存储与性能优化

从某种意义上说，WebApp 也是前端性能优化的一个产物，它优异的性能表现，要归功于浏览器存储技术的广泛应用，除了缓存外，本地存储也功不可没。

接下来我们介绍本地存储。

## Cookie

其实 Cookie 的本职工作并非本地存储，而是 “维持状态”。

Cookie 诞生的背景是什么？

在 Web 开发的早期，人们亟需解决的一个问题就是状态管理的问题：HTTP 协议是一个无状态协议，服务器接收客户端的请求，返回一个响应，故事到此就结束了，服务器并没有记录下关于客户端的任何信息。那么下次请求的时候，如何让服务器知道“我是我”呢？于是，Cookie 应运而生。

**Cookie 是以键值对存储在浏览器中的小文本文件**。

**Cookie 的性能劣势**

1. Cookie 不够大，体积有限最大不超过 4kb
2. Cookie 是紧跟域名的，同一个域名下的所有请求都会携带 Cookie，随着请求数增加，会造成性能浪费

## Web Storage

为了弥补 Cookie 的局限性，Web Storage(存储量根据浏览器不同，可达到 5 ~ 10M) 出现。

Web Storage 是 HTML5 专门为浏览器存储而提供的数据存储机制，分为：Local Storage 与 Session Storage。

两者的区别仅在于**生命周期**和**作用域**不同。

**生命周期**

LocalStorage 是持久化的本地存储，SessionStorage 是会话级别的临时存储。

**作用域**

LocalStorage 和 SessionStorage 都遵循浏览器的同源策略(Cookie 也是)，但是 SessionStorage 的特别之处在于，即便是相同域名下的两个页面，只要它们不在同一个浏览器窗口中打开，那么它们的 Session Storage 内容也无法共享(只作用于当前 Tab)。

### LocalStorage

Local Storage 的特点之一是持久，有时我们更倾向于用它来存储一些内容稳定的资源。比如图片内容丰富的电商网站会用它来存储 Base64 格式的图片字符串。

有的网站还会用它存储一些不经常更新的 CSS、JS 等静态资源。

### SessionStorage

Session Storage 更适合用来存储生命周期和它同步的会话级别的信息。比如微博的 Session Storage 就主要是存储你本次会话的浏览足迹

Web Storage 也有局限，他只能存储键值对，而且值必须是字符串，容量也有限。

## IndexedDB

**IndexedDB 是一个运行在浏览器上的非关系型数据库。**

理论上来说，IndexedDB 是没有存储上限的（一般来说不会小于 250M）。它不仅可以存储字符串，还可以存储二进制数据。

## 补充：CDN 的缓存与回源机制

CDN （Content Delivery Network，即内容分发网络）指的是一组分布在各个地区的服务器。

这些服务器存储着数据的副本，服务器会根据哪些服务器与用户距离最近，来满足数据的请求。

CDN 的核心点有两个，一个是**缓存**，一个是**回源**。

**缓存**

缓存就是我们把资源 copy 一份到 CDN 服务器上这个过程。

**回源**

CDN 发现自己没有这个资源（一般是缓存的数据过期了），转头向根服务器（或者它的上层服务器）去要这个资源的过程。

**CDN 与前端性能优化**

CDN 往往被用来存放静态资源，所谓“静态资源”，就是像 JS、CSS、图片等不需要业务服务器进行计算即得的资源。

CDN 优化一般有下面两种手段，

1. 静态资源走 CDN
2. CDN 的域名选取与业务服务器的域名不同，这样可以避免不必要的 Cookie。
